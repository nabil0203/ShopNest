{% extends 'base.html' %}

{% block title %}Shopping Cart | ShopNest{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <h1 class="font-bold text-2xl text-gray-900">Shopping Cart</h1>
    {% if cart.items.all %}
    <span class="bg-orange-500 text-white rounded-full px-4 py-2 font-semibold">{{ cart.get_total_items }} item{{ cart.get_total_items|pluralize }}</span>
    {% endif %}
</div>

{% if cart.items.all %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="bg-white border-b border-gray-100 px-6 py-4">
                <h5 class="font-semibold text-gray-900">Your Items</h5>
            </div>
            <div class="divide-y divide-gray-100">
                {% for item in cart.items.all %}
                <div class="p-6 flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex items-center gap-4 md:w-2/5">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="w-20 h-20 object-cover rounded-lg">
                        {% else %}
                        <div class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-image fa-2x text-gray-400"></i>
                        </div>
                        {% endif %}
                        <div>
                            <h6 class="font-semibold text-gray-900">{{ item.product.name }}</h6>
                            <div class="text-gray-500 text-sm">{{ item.product.category.name }}</div>
                            <a href="{% url 'product_detail' item.product.slug %}" class="text-orange-500 text-sm font-medium hover:underline">View details</a>
                        </div>
                    </div>
                    <div class="md:w-1/5 text-center font-semibold text-gray-900">৳{{ item.product.price }}</div>
                    <div class="md:w-1/5 flex items-center justify-center gap-2">
                        <form action="{% url 'cart_update' item.product.id %}" method="post" class="flex items-center gap-2">
                            {% csrf_token %}
                            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" class="w-20 text-center border border-gray-300 rounded-lg px-2 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <button type="submit" class="border border-gray-300 text-gray-600 hover:bg-orange-500 hover:text-white hover:border-orange-500 px-3 py-2 rounded-lg transition duration-300">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </form>
                    </div>
                    <div class="md:w-1/5 text-center font-semibold text-gray-900">৳{{ item.get_cost }}</div>
                    <div class="md:w-1/5 flex justify-end">
                        <form action="{% url 'cart_remove' item.product.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="bg-red-50 text-red-600 hover:bg-red-500 hover:text-white px-3 py-2 rounded-lg transition duration-300">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div>
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden sticky top-6">
            <div class="bg-white border-b border-gray-100 px-6 py-4">
                <h5 class="font-semibold text-gray-900">Order Summary</h5>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex justify-between text-gray-700">
                    <span>Subtotal ({{ cart.get_total_items }} item{{ cart.get_total_items|pluralize }}):</span>
                    <span class="font-semibold">৳{{ cart.get_total_price }}</span>
                </div>
                <div class="flex justify-between text-gray-700">
                    <span>Shipping:</span>
                    <span class="font-semibold text-green-600">Free</span>
                </div>
                <div class="flex justify-between text-gray-700">
                    <span>Taxes:</span>
                    <span class="font-semibold">Calculated at checkout</span>
                </div>
                <hr class="border-gray-200">
                <div class="flex justify-between text-lg font-bold text-gray-900">
                    <span>Total:</span>
                    <span>৳{{ cart.get_total_price }}</span>
                </div>
                <div class="space-y-2 pt-2">
                    <a href="{% url 'checkout' %}" class="block w-full text-center bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-black transition duration-300">
                        <i class="fas fa-lock mr-2"></i> Proceed to Checkout
                    </a>
                    <a href="{% url 'product_list' %}" class="block w-full text-center border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition duration-300">
                        <i class="fas fa-arrow-left mr-2"></i> Continue Shopping
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="bg-white rounded-2xl shadow-xl p-12 text-center max-w-lg mx-auto">
    <div class="text-6xl text-orange-500 mb-6">
        <i class="fas fa-shopping-cart"></i>
    </div>
    <h3 class="font-bold text-2xl text-gray-900 mb-3">Your cart is empty</h3>
    <p class="text-gray-600 mb-8">Looks like you haven't added any products to your cart yet.<br>Start shopping to add items to your cart.</p>
    <a href="{% url 'product_list' %}" class="inline-flex items-center gap-2 bg-orange-500 text-white px-8 py-4 rounded-lg font-semibold hover:bg-black transition duration-300">
        <i class="fas fa-store"></i> Browse Products
    </a>
</div>
{% endif %}
{% endblock %}
